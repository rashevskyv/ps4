---
permalink: /game-dumps.html
title: Создание дампов собственных игр
author_profile: true
---
{% include toc title="Разделы" %}

Дампить можно как дисковые версии игр, так и цифровые!

# Что понадобится

* [Fake PKG tools](files/fpkgtools.zip){:target="**_blank**"}
* USB-накопитель не менее 100Гб (это условная цифра, в ряде случаев игры весят много меньше и спокойно смогут поместится на флешку в 32Гб)
* Свободное место на жестком диске ПК в количестве равном размеру игры, или двукратное количество свободного места на USB-накопителе

# Инструкция

## Часть I - Подготовительные работы

1. **Если игра на диске**: 
	1. Запустите игру на консоли и дойдите до главного меню. Дождитесь окончания установки игры на диск, как правило этот момент соответствует моменту остановки диска в приводе (ориентируйтесь на слух)
		* Полоска установки на иконке дисковой версии игры никак **не связана** с установкой игры на диск!!
	1. Закройте игру
1. [Обновите игру до последней версии](game-patches){:target="**_blank**"}, если это возможно

## Часть II - Дампинг игры на носитель

1. Отключите на приставке режим сна, если он был включен (**Настройки** -> **Настройки энергесбережения** -> **Задать время до выключения системы PS4** -> **Общая настройка (Приложения)** -> **Не выключать**)
1. На приставке перейдите в Настройки в пункт "**Руководство пользователя/полезная информация**", "**Руководство пользователя**" или в браузер, если запускаете эксплойт из него
	+ При возникновении ошибки перезагрузите приставку
1. Вместо руководства откроется страница "**Exploit Selection**" 
1. Выберите версию вашей прошивки -> **Dumper** (пейлоад может называться иначе в другом хост-меню)
	* Дождитесь сообщения, что дампер ожидает USB-носитель
1. Рекомендуется свернуть (именно свернуть, не закрыть!) браузер
	* Не заходите ни в какие меню, иначе браузер будет выгружен из памяти и дамп прервётся!
1. Подключите к приставке внешний USB-носитель. Именно на него будет делаться дамп. Убедитесь, что там достаточно свободного места
1. Запустите игру и не выходите из неё
<!-- 1. Сверните игру 
	* Игру необходимо именно свернуть, а не закрывать! -->
1. Дождитесь сообщения, говорящего о том, что дамп начат
	* Если вы видите сообщение "**Waiting for copying game**", но диск в приставке не крутится, значит в игре существует множество языковых пакетов, которые копируются только в том случае, если на приставке стоит соответствующий язык в настройках. Чтобы сдампить такую игру, вам потребется перейти в "**Настройки** -> **Язык** -> **Язык системы**"б поочередно включать каждый из языков и после каждого переключения запускать игру. Если языковой пакет есть на диске, он будет установлен. После того, как пройдёте все языки, перезапустите дампер. 
	* По мере дампинга будут всплывать сообщения, говорящие о том, что именно делает дампер
	* Убедиться в том, что дамп идёт и ничего не зависло можно по мерцанию светодиода на вашем USB-носителе
	* Дамп будет сниматься довольно продолжительное время, следите за тем, чтобы приставка не ушла в спящий режим, если он включен
1. По завершению дампинга приставка выключится
1. Вставьте носитель, на который делался дамп, в ПК. Если дамп сделан успешно, в корне диска появятся две папки вида `CUSAxxxxx-app` и `CUSAxxxxx-patch`, а так же файл `CUSAxxxxx.complete`. Именно наличие последнего говорит о том, что дамп сделан успешно. Если этого файла нет, дамп нужно снимать по новой. 

## Часть III - Проверка трофеев 

1. Распакуйте [Fake PKG tools](files/fpkgtools.zip){:target="**_blank**"} в папку в корень любого диска на вашем ПК 
1. Перетяните поочередно `CUSAxxxxx-app` и `CUSAxxxxx-patch` на файл `Fake PKG Tools/helper.exe`
	* Если вы видите надпись "**Trophies are encrypted**", то трофеи в дампе зашифрованы. Вам нужно:
		1. Запустите [FTP-сервер](ftp){:target="_blank"} на вашей приставке
		1. Подключитесь любым удобным FTP-клиентом (рекомендуется Filezilla)
		1. Скопируйте файл `TROPHY.TRP`, находящийся по пути `/user/trophy/conf/NPWRxxxxx_00` (значение **NPWRxxxxx_00** будет указан в окне программы `helper.exe` в первой строке) в любую удобную для вас папку
		1. Переименуйте `TROPHY.TRP` в `trophy00.trp` и поместите в папку с дампом игры или патча по пути `CUSAxxxxx-app\sce_sys\trophy` или `CUSAxxxxx-patch\sce_sys\trophy` с заменой, в зависимости от того, где трофеи зашифрованы. Если зашифрованы и там и там, поместите в обе папки.
	* Если вы видите надпись "**Trophies are already unencrypted.**", то ваши трофеи расшифрованы и ничего предпринемать не нужно
	* Если в одной из двух папок (патча и приложения, относящихся к одной и той же игре) трофеи расшифрованы, а в другой нет - вы можете просто переместить расшифрованный трофей вместо зашифрованного.

## Часть IV - Создание файла GP4 

1. Подключите USB-накопитель с дампом игры к ПК
1. Запустите `Fake PKG Tools/gengp4.exe` из папки `PS4` на вашем ПК
1. Нажмите '**File -> Open**' и выберите папку на USB-носителе, названную "**CUSAxxxxx-app**" вашей игры
1. Нажмите '**Generate GP4**'
1. Дождитесь окончания создания списка
1. Нажмите '**Save GP4**'
1. Выберите место для сохранения `.gp4-файла` с проектом для вашей игры
1. Повторите для патча

## Часть V - Собираем игру в PKG

1. Запустите `Fake PKG Tools/orbis-pub-gen.exe` из папки с **Fake PKG Generator** 
1. Нажмите '**File -> Open**' и выберите `.gp4-файл` с проектом для вашей игры
1. Нажмите '**Command -> Build Image**'
1. Отметьте пункт '**Modifiable package file**'
1. Нажмите '**Select**', выберите куда сохранить `.PKG-файл` с вашей игрой и затем нажмите "**Build**"
	* Помните, что игра весит много! Выберите место для сохранения с учетом этого!
	* Для хранения временных файлов использует диск `С:\` Если у вас на диске недостаточно свободного места, то изменить расположение папки для временных файлов можно зайдя в `Мой компьютер -> Свойства -> Дополнительно -> Переменные среды`, после чего изменить расположение переменных сред `TEMP` и `TMP` для пользователя и для системы.
1. По окончанию процесса в выбранной папке будет создан дамп игры в формате fakePKG
	
## Часть IV - Cобираем патч в PKG

1. Подключите USB-накопитель с дампом игры к ПК
1. Запустите `gengp4.exe` из папки `PS4` на вашем ПК
1. Нажмите '**File** -> **Open**' и выберите папку на USB-носителе, названную "**CUSAxxxxx-patch**"
1. Нажмите '**Generate GP4**'
1. Дождитесь окончания создания списка
1. Нажмите '**Save GP4**'
1. Выберите место для сохранения `.gp4-файла` с проектом для вашей игры
1. Запустите `orbis-pub-gen.exe` из папки с **Fake PKG Generator** 
1. Нажмите '**File** -> **Open**' и выберите `.gp4-файл` с проектом для вашей игры
1. Нажмите '**Command** -> **Project Settings** -> **Patch**'
1. В строке '**Application package**' нажмите кнопку '**Select**' и выберите `.PKG` файл **игры** который мы создали в предыдущих пунктах.
1. Нажмите '**OK**', затем '**File** -> **Save**'. 
1. В окне программы нажмите '**Command** -> **Build Image**'
1. В открывшемся окне нажмите '**Select**', выберите куда сохранить `.PKG-файл` с вашей игрой и затем нажмите "**Build**"
	* Для хранения временных файлов использует диск `С:\\` Если у вас на диске недостаточно свободного места, то изменить расположение папки для временных файлов можно зайдя в `Мой компьютер -> Свойства -> Дополнительно -> Переменные среды`, после чего изменить расположение переменных сред TEMP и TMP для пользователя и для системы.
1. По окончанию процесса в выбранной папке будет создан патч для игры в формате fakePKG

## Часть VI - Дампим DLC

DLC делятся на два типа - ключи разблокировки и DLC с дополнительными файлами. В первом случае DLC является просто ключом для контента, который и так уже есть в игре, DLC его просто активирует. Во втором же случае DLC добавляет контент в игру и содержит в себе ещё ряд дополнительных файлов, за счёт которых, собственно, и идёт добавление нового контента. Дампятся они так же по разному. 

Для того, чтобы понять какого типа ваше дополнение, перейдите в [Playstation Store](https://store.playstation.com/en-us/home/games){:target="_blank"}, **введите в поиске название вашей игры и перейдите на её страницу. Пролистайте вниз и в разделе "Дополнения**" выберите интересующее вас DLC. Посмотрите в левую часть страницы, под изображением игры. Если там указан размер игры - это DLC второго типа. Если размера нет - первого. 

![]({{ base_path }}/images/screenshots/dlc-types.png) 
{: .text-center}
{: .notice--info}

### Дампинг DLC первого типа (без дополнительных данных)

#### Что понадобится

* Свежая версия [psDLC](https://github.com/stooged/psDLC/releases/latest){:target="_blank"}

1. Распакуйте `.zip`-архив psDLC в ту же папку, где у вас находится `orbis-pub-cmd.exe` (**Fake PKG Generator**)
1. Запустите `psDLC.exe`
1. Введите ID игры для которой ищите DLC в текстовое поле и нажмите "Get DLC List"
1. Выберите нужное DLC (Add-On) и нажмите кнопку Create fPKG 
1. Нужное DLC в формате fakePKG появится в папке `fake_dlc_pkg`
	
### Дампинг DLC второго типа (с дополнительными данными)

1. Запустите игру на консоли и дойдите до главного меню. Дождитесь окончания установки игры на диск, как правило этот момент соответствует моменту остановки диска в приводе (ориентируйтесь на слух)
	* Полоска установки на иконке дисковой версии игры никак **не связана** с установкой игры на диск!!
1. Сверните игру, нажав кнопку (PS)
1. [Подключитесь по FTP](ftp){:target="_blank"} к вашей приставке 
1. Перейдите в папку `/mnt/sandbox/pfsmnt/`
1. Скачайте все папки названия которых оканчивается на `-ac` - это папки, содержащие расшифрованные DLC
	* Например '/mnt/sandbox/pfsmnt/EP0177-CUSA06211_00-DIVAFT39FUTURE00-ac'
1. Запустите `orbis-pub-sfo.exe` из папки с **Fake PKG Generator** 
1. В основном окне в списке "**Category**" выберите "**(PS4) Additional Content**"
1. Нажмите "**Yes**"
1. В поле "**ContentID**" впишите ID вашего DLC. Его можно найти на странице вашего дополнения в [Playstation Store](https://store.playstation.com/en-us/home/games){:target="_blank"} в адресной строке браузера 
	* Например для 'Hatsune Miku: Project DIVA Future Tone Future Sound' это будет `EP0177-CUSA06211_00-DIVAFT39FUTURE00`
1. В левой части окна выберите "**Title Text**" и в поле "**Additional Content Name (Default Language)**" введите название вашего DLC, которое так же можно посмотреть в [Playstation Store](https://store.playstation.com/en-us/home/games){:target="_blank"}
	* Например 'Hatsune Miku: Project DIVA Future Tone Future Sound'
1. В меню "**File" выберите "Save**" и сохраните полученный `.sfo`-файл в папке `PS4/sce_sys` под именем `param.sfo`
	* Например 'PS4/sce_sys/param.sfo'
1. Запустите `orbis-pub-gen.exe` из папки с **Fake PKG Generator** 
1. В меню "**File" выберите "New Project -> Additional Content Package *with* Extra Data**"
1. Дважды нажмите на "**Image0**" и перетащите содержимое папки, содержащей DLC (папка sce_sys + все, что там есть - файлы или директории)
1. Закройте окно
1. В меню "**Commands" выберите "Project settings" и перейдите на вкладку "Package**"
1. В поле "****ContentID****" впишите ID вашего DLC, который вы использовали ранее
	* Например для 'Hatsune Miku: Project DIVA Future Tone Future Sound' это будет `EP0177-CUSA06211_00-DIVAFT39FUTURE00`
1. в поле "**Passcode (32 chars)**" введите `00000000000000000000000000000000`, убедитесь, что в поле "**Entitlement Key**" так же прописано `00000000000000000000000000000000`
1. Нажмите "**OK**"
1. В меню Command выберите "**Build Image -> Output Path**" и выберите место для сохранения вашего fakePKG и нажмите "**Build**"
1. Подождите пока создастся PKG-файл. 
	
## Часть VI - Проверка дампа

Созданный дамп необходимо проверить на работоспособность перед тем, как распространять. Если вы снимали дамп с дисковой версии игры, игру и все её данные нужно будет удалить с приставки. Цифровую версию лучше не удалять, поскольку после вы не сможете её восстановить и сделать дамп заново, если в предыдущий раз этого сделать не получилось. 

1. Удалите лицензионную версию игры и её данные с приставки
1. [Установите](games) собранные pkg-файлы в таком порядке: ИГРА -> ПАТЧ -> DLC
1. Запустите установленную игру и проверьте работают ли сохранения
1. Если игра запускается и сохранения работают, то дам сделан успешно